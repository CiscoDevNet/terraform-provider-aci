// Code generated by "gen/generator.go"; DO NOT EDIT.
// In order to regenerate this file execute `go generate` from the repository root.
// More details can be found in the [README](https://github.com/CiscoDevNet/terraform-provider-aci/blob/master/README.md).

package provider

import (
	"testing"
	"regexp"

	"github.com/hashicorp/terraform-plugin-testing/helper/resource"
)

{{- if .parents}}
	{{- range .parents}}{{$target_classes := .target_classes}}
		{{- $parentClassName := capitalize .class_name }}
func TestAccDataSource{{$.resourceClassName}}With{{capitalize .class_name}} (t *testing.T) {

	resource.Test(t, resource.TestCase{
		PreCheck:                 func() { testAccPreCheck(t) },
		ProtoV6ProviderFactories: testAccProtoV6ProviderFactories,
		Steps: []resource.TestStep{
			{
				Config: testConfig{{$.resourceClassName}}DataSourceDependencyWith{{capitalize .class_name}} ,
				ExpectNonEmptyPlan: {{.class_in_parent}},
				Check: resource.ComposeAggregateTestCheckFunc(
					{{- range $key, $value := $.datasource_required}}
						{{- if eq $key "target_dn" }}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}", "{{$key}}", "{{getTestTargetDn $.targets $.resourceName $value false $target_classes 0}}"),
						{{- else }}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}", "{{$key}}", "{{$value}}"),
						{{- end }}
					{{- end}}
					{{- range $key, $value := $.default}}
						{{- if (isInterfaceSlice $value)}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}", "{{$key}}.#", "{{len $value}}"),
							{{- range $index, $subvalue := $value}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}", "{{$key}}.{{$index}}", "{{$subvalue}}"),
							{{- end}}
						{{- else}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}", "{{$key}}", "{{$value}}"),
						{{- end}}
					{{- end}}
					{{- range $index, $key := $.read_only}}
					resource.TestCheckResourceAttrSet("data.aci_{{$.resourceName}}.test", "{{$key}}"),
					{{- end}}
				),
			},
			{
				Config:      testConfig{{$.resourceClassName}}NotExisting{{capitalize .class_name}},
				ExpectError: regexp.MustCompile("Failed to read aci_{{$.resourceName}} data source"),
			},
		},
	})
}
	{{- end}}
{{- else}}
func TestAccDataSource{{.resourceClassName}}(t *testing.T) {

	resource.Test(t, resource.TestCase{
		PreCheck:                 func() { testAccPreCheck(t) },
		ProtoV6ProviderFactories: testAccProtoV6ProviderFactories,
		Steps: []resource.TestStep{
			{
				Config: testConfig{{.resourceClassName}}DataSource,
				Check: resource.ComposeAggregateTestCheckFunc(
					{{- range $key, $value := .min}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test", "{{$key}}", "{{$value}}"),
					{{- end}}
					{{- range $key, $value := .all}}
						{{- if (isInterfaceSlice $value)}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test", "{{$key}}.#", "{{len $value}}"),
							{{- range $index, $subvalue := $value}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test", "{{$key}}.{{$index}}", "{{$subvalue}}"),
							{{- end}}
						{{- else}}
					resource.TestCheckResourceAttr("data.aci_{{$.resourceName}}.test", "{{$key}}", "{{$value}}"),
						{{- end}}
					{{- end}}
				),
			},
			{
				Config:      testConfig{{.resourceClassName}}NotExisting,
				ExpectError: regexp.MustCompile("Failed to read aci_{{$.resourceName}} data source"),
			},
		},
	})
}
{{- end}}

{{- if .parents}}
	{{- range .parents}}{{$target_classes := .target_classes}}
		{{- $parentClassName := capitalize .class_name }}
const testConfig{{$.resourceClassName}}DataSourceDependencyWith{{capitalize .class_name}}  = testConfig{{$.resourceClassName}}MinDependencyWith{{capitalize .class_name}}  + `
data "aci_{{$.resourceName}}" "test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}" {
  parent_dn = {{.parent_dn}}
  {{- range $key, $value := $.datasource_required}}
		{{- if eq $key "target_dn" }}{{$attributeValue := getTestTargetDn $.targets $.resourceName $value true $target_classes 0}}
  {{$key}} = {{if containsString $attributeValue "."}}{{$attributeValue}}{{else}}"{{$attributeValue}}"{{end}}
		{{- else }}
  {{$key}} = "{{$value}}"
		{{- end }}
  {{- end}}
  depends_on = [aci_{{$.resourceName}}.test{{- if eq $.resourceClassName $parentClassName }}_1{{- end }}]
}
`

{{- if (eq $.resourceClassName "FvSiteAssociated") }}

const testConfig{{$.resourceClassName}}NotExisting{{capitalize .class_name}}  = testConfig{{capitalize .class_name}}MinDependencyWithFvTenant  + `
{{- else}}

const testConfig{{$.resourceClassName}}NotExisting{{capitalize .class_name}}  = testConfig{{$.resourceClassName}}MinDependencyWith{{capitalize .class_name}}  + `
{{- end }}
data "aci_{{$.resourceName}}" "test_non_existing" {
  parent_dn = {{.parent_dn}}
  {{- range $key, $value := $.datasource_non_existing}}
		{{- if and (eq $key "target_dn") (not (hasPrefix $value "topology/")) }}
  {{$key}} = "{{getTestTargetDn $.targets $.resourceName $value false $target_classes 0}}_not_existing"
		{{- else }}
  {{$key}} = "{{$value}}"
		{{- end }}
  {{- end}}
  {{- if $.datasource_required }}
  depends_on = [aci_{{$.resourceName}}.test]
  {{- end }}
}
`
	{{- end}}
{{- else}}
const testConfig{{.resourceClassName}}DataSource = testConfig{{.resourceClassName}}All + `
data "aci_{{$.resourceName}}" "test" {
  {{- range $key, $value := $.datasource_required}}
		{{- if eq $key "target_dn" }}{{$attributeValue := getTestTargetDn $.targets $.resourceName $value true nil 0}}
  {{$key}} = {{if containsString $attributeValue "."}}{{$attributeValue}}{{else}}"{{$attributeValue}}"{{end}}
		{{- else }}
  {{$key}} = "{{$value}}"
		{{- end }}
  {{- end}}
  depends_on = [aci_{{$.resourceName}}.test]
}
`

const testConfig{{$.resourceClassName}}NotExisting = testConfig{{.resourceClassName}}All + `
data "aci_{{$.resourceName}}" "test_non_existing" {
  {{- range $key, $value := $.datasource_non_existing}}
		{{- if and (eq $key "target_dn") (not (hasPrefix $value "topology/")) }}
  {{$key}} = "{{getTestTargetDn $.targets $.resourceName $value false nil 0}}_not_existing"
		{{- else }}
  {{$key}} = "{{$value}}"
		{{- end }}
  {{- end}}
}
`
{{- end}}